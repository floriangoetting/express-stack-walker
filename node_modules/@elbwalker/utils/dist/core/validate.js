"use strict";var x=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var b=(t,i)=>{for(var n in i)x(t,n,{get:i[n],enumerable:!0})},h=(t,i,n,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of R(i))!v.call(t,r)&&r!==n&&x(t,r,{get:()=>i[r],enumerable:!(e=O(i,r))||e.enumerable});return t};var W=t=>h(x({},"__esModule",{value:!0}),t);var E={};b(E,{validateEvent:()=>C,validateProperty:()=>k});module.exports=W(E);function o(t){throw new Error(String(t))}function a(t,i){return typeof t==typeof i}function w(t,i){return function(...n){try{return t(...n)}catch(e){return i?i(e):void 0}}}function C(t,i=[]){a(t,{})||o("Invalid object");let n,e,r;a(t.event,"")?(n=t.event,[e,r]=n.split(" "),(!e||!r)&&o("Invalid event name")):a(t.entity,"")&&a(t.action,"")?(e=t.entity,r=t.action,n=`${e} ${r}`):o("Missing or invalid event, entity, or action");let f={"*":{"*":{event:{maxLength:255},user:{allowedKeys:["id","device","session"]},consent:{allowedValues:[!0,!1]},timestamp:{min:0},timing:{min:0},count:{min:0},version:{allowedKeys:["client","tagging"]},source:{allowedKeys:["type","id","previous_id"]}}}},d={event:n,data:{},context:{},custom:{},globals:{},user:{},nested:[],consent:{},id:"",trigger:"",entity:e,action:r,timestamp:0,timing:0,group:"",count:0,version:{client:"",tagging:0},source:{type:"",id:"",previous_id:""}};return[f].concat(i).reduce((g,p)=>["*",e].reduce((P,u)=>["*",r].reduce((s,S)=>{var m;let c=(m=p[u])==null?void 0:m[S];return c?s.concat([c]):s},P),g),[]).reduce((g,p)=>{let P=Object.keys(p).filter(u=>{let s=p[u];return(s==null?void 0:s.required)===!0});return[...Object.keys(t),...P].reduce((u,s)=>{let S=p[s],c=t[s];return S&&(c=w(k,m=>{o(String(m))})(u,s,c,S)),a(c,u[s])&&(u[s]=c),u},g)},d)}function k(t,i,n,e){if(e.validate&&(n=w(e.validate,r=>{o(String(r))})(n,i,t)),e.required&&n===void 0&&o("Missing required property"),a(n,""))e.maxLength&&n.length>e.maxLength&&(e.strict&&o("Value exceeds maxLength"),n=n.substring(0,e.maxLength));else if(a(n,1))a(e.min,1)&&n<e.min?(e.strict&&o("Value below min"),n=e.min):a(e.max,1)&&n>e.max&&(e.strict&&o("Value exceeds max"),n=e.max);else if(a(n,{})){if(e.schema){let r=e.schema;Object.keys(r).reduce((f,d)=>{let l=r[d],y=f[d];return l&&(l.type&&typeof y!==l.type&&o(`Type doesn't match (${d})`),y=w(k,g=>{o(String(g))})(f,d,y,l)),y},n)}for(let[r,f]of Object.entries(n))e.allowedKeys&&!e.allowedKeys.includes(r)&&(e.strict&&o("Key not allowed"),delete n[r])}return n}0&&(module.exports={validateEvent,validateProperty});
