function i(t){throw new Error(String(t))}function s(t,a){return typeof t==typeof a}function w(t,a){return function(...n){try{return t(...n)}catch(e){return a?a(e):void 0}}}function W(t,a=[]){s(t,{})||i("Invalid object");let n,e,r;s(t.event,"")?(n=t.event,[e,r]=n.split(" "),(!e||!r)&&i("Invalid event name")):s(t.entity,"")&&s(t.action,"")?(e=t.entity,r=t.action,n=`${e} ${r}`):i("Missing or invalid event, entity, or action");let f={"*":{"*":{event:{maxLength:255},user:{allowedKeys:["id","device","session"]},consent:{allowedValues:[!0,!1]},timestamp:{min:0},timing:{min:0},count:{min:0},version:{allowedKeys:["client","tagging"]},source:{allowedKeys:["type","id","previous_id"]}}}},d={event:n,data:{},context:{},custom:{},globals:{},user:{},nested:[],consent:{},id:"",trigger:"",entity:e,action:r,timestamp:0,timing:0,group:"",count:0,version:{client:"",tagging:0},source:{type:"",id:"",previous_id:""}};return[f].concat(a).reduce((g,p)=>["*",e].reduce((P,u)=>["*",r].reduce((o,S)=>{var m;let c=(m=p[u])==null?void 0:m[S];return c?o.concat([c]):o},P),g),[]).reduce((g,p)=>{let P=Object.keys(p).filter(u=>{let o=p[u];return(o==null?void 0:o.required)===!0});return[...Object.keys(t),...P].reduce((u,o)=>{let S=p[o],c=t[o];return S&&(c=w(x,m=>{i(String(m))})(u,o,c,S)),s(c,u[o])&&(u[o]=c),u},g)},d)}function x(t,a,n,e){if(e.validate&&(n=w(e.validate,r=>{i(String(r))})(n,a,t)),e.required&&n===void 0&&i("Missing required property"),s(n,""))e.maxLength&&n.length>e.maxLength&&(e.strict&&i("Value exceeds maxLength"),n=n.substring(0,e.maxLength));else if(s(n,1))s(e.min,1)&&n<e.min?(e.strict&&i("Value below min"),n=e.min):s(e.max,1)&&n>e.max&&(e.strict&&i("Value exceeds max"),n=e.max);else if(s(n,{})){if(e.schema){let r=e.schema;Object.keys(r).reduce((f,d)=>{let l=r[d],y=f[d];return l&&(l.type&&typeof y!==l.type&&i(`Type doesn't match (${d})`),y=w(x,g=>{i(String(g))})(f,d,y,l)),y},n)}for(let[r,f]of Object.entries(n))e.allowedKeys&&!e.allowedKeys.includes(r)&&(e.strict&&i("Key not allowed"),delete n[r])}return n}export{W as validateEvent,x as validateProperty};
