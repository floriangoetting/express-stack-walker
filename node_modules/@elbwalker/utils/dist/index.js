"use strict";var O=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var $=(e,r)=>{for(var t in r)O(e,t,{get:r[t],enumerable:!0})},B=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of M(r))!_.call(e,o)&&o!==t&&O(e,o,{get:()=>r[o],enumerable:!(n=D(r,o))||n.enumerable});return e};var q=e=>B(O({},"__esModule",{value:!0}),e);var Q={};$(Q,{Const:()=>c,assign:()=>C,castValue:()=>w,debounce:()=>H,getAttribute:()=>F,getByStringDot:()=>v,getId:()=>P,getMarketingParameters:()=>h,isSameType:()=>f,isVisible:()=>K,onLog:()=>I,sessionStart:()=>N,storageDelete:()=>U,storageRead:()=>W,storageWrite:()=>T,throttle:()=>E,throwError:()=>l,trim:()=>L,tryCatch:()=>S,tryCatchAsync:()=>A,useHooks:()=>V,validateEvent:()=>j,validateProperty:()=>b});module.exports=q(Q);var J={Action:"action",Config:"config",Consent:"consent",Context:"context",Destination:"destination",Elb:"elb",Globals:"globals",Hook:"hook",Init:"init",Link:"link",Prefix:"data-elb",Run:"run",User:"user",Walker:"walker"},G={Cookie:"cookie",Local:"local",Session:"session"},z={Storage:G},c={Commands:J,Utils:z};function C(e,r={}){return Object.entries(r).forEach(([t,n])=>{let o=e[t];Array.isArray(o)&&Array.isArray(n)&&(r[t]=n.reduce((i,s)=>i.includes(s)?i:[...i,s],[...o]))}),{...e,...r}}function w(e){if(e==="true")return!0;if(e==="false")return!1;let r=Number(e);return e==r&&e!==""?r:String(e)}function v(e,r,t=0){return r.split(".").reduce((o,i)=>{if(i=="*"&&(i=String(t)),o instanceof Object)return o[i]},e)}function P(e=6){for(var r="",t=36;r.length<e;)r+=(Math.random()*t|0).toString(t);return r}function h(e,r={}){let t={},n=Object.assign({utm_campaign:"campaign",utm_content:"content",dclid:"clickId",fbclid:"clickId",gclid:"clickId",utm_medium:"medium",msclkid:"clickId",utm_source:"source",utm_term:"term"},r);return Object.entries(n).forEach(([o,i])=>{let s=e.searchParams.get(o);s&&(t[i]=s)}),t}function H(e,r=1e3){let t;return(...n)=>(clearTimeout(t),new Promise(o=>{t=setTimeout(()=>{o(e(...n))},r)}))}function E(e,r=1e3){let t=null;return function(...n){if(t===null)return t=setTimeout(()=>{t=null},r),e(...n)}}function f(e,r){return typeof e==typeof r}function I(e,r=!1){r&&console.dir(e,{depth:4})}function l(e){throw new Error(String(e))}function L(e){return e?e.trim().replace(/^'|'$/g,"").trim():""}function S(e,r){return function(...t){try{return e(...t)}catch(n){return r?r(n):void 0}}}function A(e,r){return async function(...t){try{return await e(...t)}catch(n){return r?await r(n):void 0}}}function V(e,r,t){return function(...n){let o,i="pre"+r,s="post"+r,u=t[i],a=t[s];return u?o=u({fn:e},...n):o=e(...n),a&&(o=a({fn:e,result:o},...n)),o}}function j(e,r=[]){f(e,{})||l("Invalid object");let t,n,o;f(e.event,"")?(t=e.event,[n,o]=t.split(" "),(!n||!o)&&l("Invalid event name")):f(e.entity,"")&&f(e.action,"")?(n=e.entity,o=e.action,t=`${n} ${o}`):l("Missing or invalid event, entity, or action");let i={"*":{"*":{event:{maxLength:255},user:{allowedKeys:["id","device","session"]},consent:{allowedValues:[!0,!1]},timestamp:{min:0},timing:{min:0},count:{min:0},version:{allowedKeys:["client","tagging"]},source:{allowedKeys:["type","id","previous_id"]}}}},s={event:t,data:{},context:{},custom:{},globals:{},user:{},nested:[],consent:{},id:"",trigger:"",entity:n,action:o,timestamp:0,timing:0,group:"",count:0,version:{client:"",tagging:0},source:{type:"",id:"",previous_id:""}};return[i].concat(r).reduce((d,k)=>["*",n].reduce((R,p)=>["*",o].reduce((m,y)=>{var x;let g=(x=k[p])==null?void 0:x[y];return g?m.concat([g]):m},R),d),[]).reduce((d,k)=>{let R=Object.keys(k).filter(p=>{let m=k[p];return(m==null?void 0:m.required)===!0});return[...Object.keys(e),...R].reduce((p,m)=>{let y=k[m],g=e[m];return y&&(g=S(b,x=>{l(String(x))})(p,m,g,y)),f(g,p[m])&&(p[m]=g),p},d)},s)}function b(e,r,t,n){if(n.validate&&(t=S(n.validate,o=>{l(String(o))})(t,r,e)),n.required&&t===void 0&&l("Missing required property"),f(t,""))n.maxLength&&t.length>n.maxLength&&(n.strict&&l("Value exceeds maxLength"),t=t.substring(0,n.maxLength));else if(f(t,1))f(n.min,1)&&t<n.min?(n.strict&&l("Value below min"),t=n.min):f(n.max,1)&&t>n.max&&(n.strict&&l("Value exceeds max"),t=n.max);else if(f(t,{})){if(n.schema){let o=n.schema;Object.keys(o).reduce((i,s)=>{let u=o[s],a=i[s];return u&&(u.type&&typeof a!==u.type&&l(`Type doesn't match (${s})`),a=S(b,d=>{l(String(d))})(i,s,a,u)),a},t)}for(let[o,i]of Object.entries(t))n.allowedKeys&&!n.allowedKeys.includes(o)&&(n.strict&&l("Key not allowed"),delete t[o])}return t}function F(e,r){return e.getAttribute(r)||""}function K(e){let r=getComputedStyle(e);if(r.display==="none"||r.visibility!=="visible"||r.opacity&&Number(r.opacity)<.1)return!1;let t,n=window.innerHeight,o=e.getBoundingClientRect(),i=o.height,s=o.y,u=s+i,a={x:o.x+e.offsetWidth/2,y:o.y+e.offsetHeight/2};if(i<=n){if(e.offsetWidth+o.width===0||e.offsetHeight+o.height===0||a.x<0||a.x>(document.documentElement.clientWidth||window.innerWidth)||a.y<0||a.y>(document.documentElement.clientHeight||window.innerHeight))return!1;t=document.elementFromPoint(a.x,a.y)}else{let d=n/2;if(s<0&&u<d||u>n&&s>d)return!1;t=document.elementFromPoint(a.x,n/2)}if(t)do if(t===e)return!0;while(t=t.parentElement);return!1}function N(e={}){let r=e.isNew||!1;if(!r){let[u]=performance.getEntriesByType("navigation");if(u.type!=="navigate")return!1}let t=new URL(e.url||window.location.href),n=e.referrer||document.referrer,o=n&&new URL(n).hostname,i={},s=h(t,e.parameters);if(Object.keys(s).length&&(i.marketing=!0,r=!0),!r){let u=e.domains||[];u.push(t.hostname),r=!u.includes(o)}return r?(o&&(i.referrer=o),Object.assign(i,{id:i.id||P(12)},s,e.data),i):!1}function U(e,r=c.Utils.Storage.Session){switch(r){case c.Utils.Storage.Cookie:T(e,"",0,r);break;case c.Utils.Storage.Local:window.localStorage.removeItem(e);break;case c.Utils.Storage.Session:window.sessionStorage.removeItem(e);break}}function W(e,r=c.Utils.Storage.Session){var i;function t(s){try{return JSON.parse(s||"")}catch(u){let a=1,d="";return s&&(a=0,d=s),{e:a,v:d}}}let n,o;switch(r){case c.Utils.Storage.Cookie:n=decodeURIComponent(((i=document.cookie.split("; ").find(s=>s.startsWith(e+"=")))==null?void 0:i.split("=")[1])||"");break;case c.Utils.Storage.Local:o=t(window.localStorage.getItem(e));break;case c.Utils.Storage.Session:o=t(window.sessionStorage.getItem(e));break}return o&&(n=o.v,o.e!=0&&o.e<Date.now()&&(U(e,r),n="")),w(n||"")}function T(e,r,t=30,n=c.Utils.Storage.Session,o){let s={e:Date.now()+6e4*t,v:String(r)},u=JSON.stringify(s);switch(n){case c.Utils.Storage.Cookie:let a=`${e}=${encodeURIComponent(r)}; max-age=${t*60}; path=/; SameSite=Lax; secure`;o&&(a+="; domain="+o),document.cookie=a;break;case c.Utils.Storage.Local:window.localStorage.setItem(e,u);break;case c.Utils.Storage.Session:window.sessionStorage.setItem(e,u);break}return W(e,n)}0&&(module.exports={Const,assign,castValue,debounce,getAttribute,getByStringDot,getId,getMarketingParameters,isSameType,isVisible,onLog,sessionStart,storageDelete,storageRead,storageWrite,throttle,throwError,trim,tryCatch,tryCatchAsync,useHooks,validateEvent,validateProperty});
//# sourceMappingURL=index.js.map