var T={Action:"action",Config:"config",Consent:"consent",Context:"context",Destination:"destination",Elb:"elb",Globals:"globals",Hook:"hook",Init:"init",Link:"link",Prefix:"data-elb",Run:"run",User:"user",Walker:"walker"},C={Cookie:"cookie",Local:"local",Session:"session"},v={Storage:C},c={Commands:T,Utils:v};function H(e,n={}){return Object.entries(n).forEach(([t,r])=>{let o=e[t];Array.isArray(o)&&Array.isArray(r)&&(n[t]=r.reduce((i,s)=>i.includes(s)?i:[...i,s],[...o]))}),{...e,...n}}function P(e){if(e==="true")return!0;if(e==="false")return!1;let n=Number(e);return e==n&&e!==""?n:String(e)}function E(e,n,t=0){return n.split(".").reduce((o,i)=>{if(i=="*"&&(i=String(t)),o instanceof Object)return o[i]},e)}function h(e=6){for(var n="",t=36;n.length<e;)n+=(Math.random()*t|0).toString(t);return n}function b(e,n={}){let t={},r=Object.assign({utm_campaign:"campaign",utm_content:"content",dclid:"clickId",fbclid:"clickId",gclid:"clickId",utm_medium:"medium",msclkid:"clickId",utm_source:"source",utm_term:"term"},n);return Object.entries(r).forEach(([o,i])=>{let s=e.searchParams.get(o);s&&(t[i]=s)}),t}function I(e,n=1e3){let t;return(...r)=>(clearTimeout(t),new Promise(o=>{t=setTimeout(()=>{o(e(...r))},n)}))}function L(e,n=1e3){let t=null;return function(...r){if(t===null)return t=setTimeout(()=>{t=null},n),e(...r)}}function m(e,n){return typeof e==typeof n}function A(e,n=!1){n&&console.dir(e,{depth:4})}function l(e){throw new Error(String(e))}function V(e){return e?e.trim().replace(/^'|'$/g,"").trim():""}function k(e,n){return function(...t){try{return e(...t)}catch(r){return n?n(r):void 0}}}function j(e,n){return async function(...t){try{return await e(...t)}catch(r){return n?await n(r):void 0}}}function F(e,n,t){return function(...r){let o,i="pre"+n,s="post"+n,u=t[i],a=t[s];return u?o=u({fn:e},...r):o=e(...r),a&&(o=a({fn:e,result:o},...r)),o}}function K(e,n=[]){m(e,{})||l("Invalid object");let t,r,o;m(e.event,"")?(t=e.event,[r,o]=t.split(" "),(!r||!o)&&l("Invalid event name")):m(e.entity,"")&&m(e.action,"")?(r=e.entity,o=e.action,t=`${r} ${o}`):l("Missing or invalid event, entity, or action");let i={"*":{"*":{event:{maxLength:255},user:{allowedKeys:["id","device","session"]},consent:{allowedValues:[!0,!1]},timestamp:{min:0},timing:{min:0},count:{min:0},version:{allowedKeys:["client","tagging"]},source:{allowedKeys:["type","id","previous_id"]}}}},s={event:t,data:{},context:{},custom:{},globals:{},user:{},nested:[],consent:{},id:"",trigger:"",entity:r,action:o,timestamp:0,timing:0,group:"",count:0,version:{client:"",tagging:0},source:{type:"",id:"",previous_id:""}};return[i].concat(n).reduce((d,S)=>["*",r].reduce((w,p)=>["*",o].reduce((f,y)=>{var x;let g=(x=S[p])==null?void 0:x[y];return g?f.concat([g]):f},w),d),[]).reduce((d,S)=>{let w=Object.keys(S).filter(p=>{let f=S[p];return(f==null?void 0:f.required)===!0});return[...Object.keys(e),...w].reduce((p,f)=>{let y=S[f],g=e[f];return y&&(g=k(R,x=>{l(String(x))})(p,f,g,y)),m(g,p[f])&&(p[f]=g),p},d)},s)}function R(e,n,t,r){if(r.validate&&(t=k(r.validate,o=>{l(String(o))})(t,n,e)),r.required&&t===void 0&&l("Missing required property"),m(t,""))r.maxLength&&t.length>r.maxLength&&(r.strict&&l("Value exceeds maxLength"),t=t.substring(0,r.maxLength));else if(m(t,1))m(r.min,1)&&t<r.min?(r.strict&&l("Value below min"),t=r.min):m(r.max,1)&&t>r.max&&(r.strict&&l("Value exceeds max"),t=r.max);else if(m(t,{})){if(r.schema){let o=r.schema;Object.keys(o).reduce((i,s)=>{let u=o[s],a=i[s];return u&&(u.type&&typeof a!==u.type&&l(`Type doesn't match (${s})`),a=k(R,d=>{l(String(d))})(i,s,a,u)),a},t)}for(let[o,i]of Object.entries(t))r.allowedKeys&&!r.allowedKeys.includes(o)&&(r.strict&&l("Key not allowed"),delete t[o])}return t}function N(e,n){return e.getAttribute(n)||""}function D(e){let n=getComputedStyle(e);if(n.display==="none"||n.visibility!=="visible"||n.opacity&&Number(n.opacity)<.1)return!1;let t,r=window.innerHeight,o=e.getBoundingClientRect(),i=o.height,s=o.y,u=s+i,a={x:o.x+e.offsetWidth/2,y:o.y+e.offsetHeight/2};if(i<=r){if(e.offsetWidth+o.width===0||e.offsetHeight+o.height===0||a.x<0||a.x>(document.documentElement.clientWidth||window.innerWidth)||a.y<0||a.y>(document.documentElement.clientHeight||window.innerHeight))return!1;t=document.elementFromPoint(a.x,a.y)}else{let d=r/2;if(s<0&&u<d||u>r&&s>d)return!1;t=document.elementFromPoint(a.x,r/2)}if(t)do if(t===e)return!0;while(t=t.parentElement);return!1}function M(e={}){let n=e.isNew||!1;if(!n){let[u]=performance.getEntriesByType("navigation");if(u.type!=="navigate")return!1}let t=new URL(e.url||window.location.href),r=e.referrer||document.referrer,o=r&&new URL(r).hostname,i={},s=b(t,e.parameters);if(Object.keys(s).length&&(i.marketing=!0,n=!0),!n){let u=e.domains||[];u.push(t.hostname),n=!u.includes(o)}return n?(o&&(i.referrer=o),Object.assign(i,{id:i.id||h(12)},s,e.data),i):!1}function O(e,n=c.Utils.Storage.Session){switch(n){case c.Utils.Storage.Cookie:W(e,"",0,n);break;case c.Utils.Storage.Local:window.localStorage.removeItem(e);break;case c.Utils.Storage.Session:window.sessionStorage.removeItem(e);break}}function U(e,n=c.Utils.Storage.Session){var i;function t(s){try{return JSON.parse(s||"")}catch(u){let a=1,d="";return s&&(a=0,d=s),{e:a,v:d}}}let r,o;switch(n){case c.Utils.Storage.Cookie:r=decodeURIComponent(((i=document.cookie.split("; ").find(s=>s.startsWith(e+"=")))==null?void 0:i.split("=")[1])||"");break;case c.Utils.Storage.Local:o=t(window.localStorage.getItem(e));break;case c.Utils.Storage.Session:o=t(window.sessionStorage.getItem(e));break}return o&&(r=o.v,o.e!=0&&o.e<Date.now()&&(O(e,n),r="")),P(r||"")}function W(e,n,t=30,r=c.Utils.Storage.Session,o){let s={e:Date.now()+6e4*t,v:String(n)},u=JSON.stringify(s);switch(r){case c.Utils.Storage.Cookie:let a=`${e}=${encodeURIComponent(n)}; max-age=${t*60}; path=/; SameSite=Lax; secure`;o&&(a+="; domain="+o),document.cookie=a;break;case c.Utils.Storage.Local:window.localStorage.setItem(e,u);break;case c.Utils.Storage.Session:window.sessionStorage.setItem(e,u);break}return U(e,r)}export{c as Const,H as assign,P as castValue,I as debounce,N as getAttribute,E as getByStringDot,h as getId,b as getMarketingParameters,m as isSameType,D as isVisible,A as onLog,M as sessionStart,O as storageDelete,U as storageRead,W as storageWrite,L as throttle,l as throwError,V as trim,k as tryCatch,j as tryCatchAsync,F as useHooks,K as validateEvent,R as validateProperty};
//# sourceMappingURL=index.mjs.map